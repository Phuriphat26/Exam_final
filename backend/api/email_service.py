from flask_mail import Mail, Message
from datetime import datetime
import os
# 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Instance ‡∏Ç‡∏≠‡∏á Mail ‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡πÇ‡∏î‡∏¢‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö app
mail = Mail()

def send_notification_email(subject, recipient_email):
    """
    ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (‡πÅ‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à)
    """
    try:
        # (‡∏î‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•)
        current_time_str = datetime.now().strftime('%H:%M')
        
        msg = Message(
            # --- Subject ---
            subject=f"‡πÑ‡∏î‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡∏∏‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ {subject} ‡πÅ‡∏•‡πâ‡∏ß! üöÄ", 
            sender=os.getenv('MAIL_DEFAULT_SENDER'),
            recipients=[recipient_email],
            # --- Body ---
            body=f"‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö,\n\n"
                 f"‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏°‡∏≤‡∏ò‡∏¥‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°! üß†\n\n"
                 f"‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ( {current_time_str} ‡∏ô.) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤ {subject} ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß\n\n"
                 f"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏™‡∏≠‡∏ö‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏™‡∏π‡πâ‡πÜ!"
        )
        
        mail.send(msg)
        print(f"‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡πÅ‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤ {subject} ‡πÑ‡∏õ‡∏¢‡∏±‡∏á {recipient_email} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
    
    except Exception as e:
        print(f"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•: {e}")






"""def send_notification_email(subject, recipient_email):
    try:
        msg = Message(
            subject=f"üîî ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡πÑ‡∏î‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡πà‡∏≤‡∏ô {subject} ‡πÅ‡∏•‡πâ‡∏ß!",
            recipients=[recipient_email],
            body=f"‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ,\n\n‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ( {datetime.now().strftime('%H:%M')} ‡∏ô.) ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ {subject} ‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢!"
        )
        
        # mail.send() ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å mail.init_app(app) ‡πÉ‡∏ô app.py
        mail.send(msg)
        print(f"‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤ {subject} ‡πÑ‡∏õ‡∏¢‡∏±‡∏á {recipient_email} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
    
    except Exception as e:
        print(f"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•: {e}")"""